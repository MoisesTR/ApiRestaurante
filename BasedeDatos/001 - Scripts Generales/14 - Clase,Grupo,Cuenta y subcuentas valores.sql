--ENLACE DE PAGINA WEB DONDE ESTA MAS DETALLADO
--https://puc.com.co/
USE ATOMIC_RESTAURANTE;
GO

--IF OBJECT_ID('dbo.CONTABILIDAD_MOVIMIENTO_SUBCUENTA') IS NOT NULL
--BEGIN	
--	ALTER TABLE dbo.CONTABILIDAD_MOVIMIENTO_SUBCUENTA
--	DROP CONSTRAINT FK_Contabilidad_SubCuenta_Movimiento
--END
GO
ALTER TABLE dbo.CONTABILIDAD_GRUPO_CUENTA
DROP CONSTRAINT FK_Contabilidad_Clase_Grupo_Cuenta

GO

ALTER TABLE dbo.CONTABILIDAD_CUENTA
DROP CONSTRAINT FK_Contabilidad_Cuenta_Grupo

GO

ALTER TABLE dbo.CONTABILIDAD_SUBCUENTA
DROP CONSTRAINT FK_Cuenta_de_SubCuenta

--GO

IF OBJECT_ID('dbo.CONTABILIDAD_CLASE_CUENTA') IS NOT NULL
	DROP TABLE dbo.CONTABILIDAD_CLASE_CUENTA
GO
CREATE TABLE	dbo.CONTABILIDAD_CLASE_CUENTA ( 
	IdClasCuenta		TINYINT,
	Naturaleza			BIT				NOT NULL,
	NombClasC			NVARCHAR(100)	NOT NULL,
	DescClasC			NVARCHAR(150)	NULL,
	Habilitado			BIT				NOT NULL	DEFAULT 1,
	CreatedAt			SMALLDATETIME	NOT NULL	DEFAULT GETDATE(),
	UpdatedAt			SMALLDATETIME	NULL,
	CONSTRAINT	PK_Contabilidad_Tipo_Cuenta		PRIMARY KEY(IdClasCuenta)
);

GO
IF OBJECT_ID('dbo.CONTABILIDAD_GRUPO_CUENTA') IS NOT NULL
	DROP TABLE dbo.CONTABILIDAD_GRUPO_CUENTA
GO
CREATE TABLE dbo.CONTABILIDAD_GRUPO_CUENTA ( 
	IdGrupo				TINYINT			NOT NULL,
	IdClasCuenta		TINYINT			NOT NULL,
	NombGrupo			NVARCHAR(100)	NOT NULL,
	Habilitado			BIT				NOT NULL	DEFAULT 1,
	CreatedAt			SMALLDATETIME	NOT NULL	DEFAULT GETDATE(),
	UpdatedAt			SMALLDATETIME	NULL,
	CONSTRAINT FK_Contabilidad_Clase_Grupo_Cuenta	FOREIGN KEY(IdClasCuenta)
				REFERENCES dbo.CONTABILIDAD_CLASE_CUENTA(IdClasCuenta),
	CONSTRAINT PK_CONTABILIDAD_GRUPO_CUENTA		PRIMARY KEY(IdGrupo, IdClasCuenta)
)
GO


--La nomemclatura usada para las cuentas sera la siguiente
--El primer caracter representara la clase
--Grupo: Dos Primeros caracteres
--Cuenta: Estara conformado por los primeros 4 digitos
--Subcuenta: Estara conformado por los primeros 6 digitos
IF OBJECT_ID('dbo.CONTABILIDAD_CUENTA') IS NOT NULL
	DROP TABLE dbo.CONTABILIDAD_CUENTA
GO
CREATE TABLE	dbo.CONTABILIDAD_CUENTA (
	IdCuenta			TINYINT		IDENTITY(1,1),
	IdClasCuenta		TINYINT		NOT NULL,
	IdGrupo				TINYINT		NOT NULL,
	IdMoneda			TINYINT		NOT NULL,
	NumCuenta			NVARCHAR(4)		NOT NULL,
	NombCuenta			NVARCHAR(50)	NOT NULL,
	DescCuenta			NVARCHAR(150)	NULL,
	Habilitado			BIT				NOT NULL	DEFAULT 1,
	CreatedAt			SMALLDATETIME	NOT NULL	DEFAULT GETDATE(),
	UpdatedAt			SMALLDATETIME	NULL,
	CONSTRAINT	PK_Contabilidad_Cuenta		PRIMARY KEY(NumCuenta),
	CONSTRAINT	FK_Contabilidad_Cuenta_Grupo		FOREIGN KEY(IdGrupo, IdClasCuenta)
				REFERENCES	dbo.CONTABILIDAD_GRUPO_CUENTA(IdGrupo, IdClasCuenta),
	CONSTRAINT	FK_Contabilidad_Moneda_Cuenta	FOREIGN KEY(IdMoneda)
				REFERENCES	dbo.FACTURACION_MONEDA(IdMoneda),
	--CONSTRAINT	PK_Contabilidad_Cuenta_Restaurante	FOREIGN KEY(IdRestaurante)
	--			REFERENCES dbo.RESTAURANTE(IdRestaurante)
);
GO


IF OBJECT_ID('dbo.CONTABILIDAD_SUBCUENTA') IS NOT NULL
	DROP TABLE dbo.CONTABILIDAD_SUBCUENTA
GO
CREATE TABLE dbo.CONTABILIDAD_SUBCUENTA (
	IdSubCuenta			INT	IDENTITY(1,1),
	NumCuenta			NVARCHAR(4),
	NumSubCuenta		NVARCHAR(6),
	NombSubCuenta		NVARCHAR(100),
	DescSubCuenta		NVARCHAR(150),
	Habilitado			BIT				NOT NULL	DEFAULT 1,
	CreatedAt			SMALLDATETIME	NOT NULL	DEFAULT GETDATE(),
	UpdatedAt			SMALLDATETIME	NULL,
	CONSTRAINT		FK_Cuenta_de_SubCuenta FOREIGN KEY(NumCuenta)
				REFERENCES dbo.CONTABILIDAD_CUENTA(NumCuenta),
	CONSTRAINT		PK_SubCuenta	PRIMARY KEY(NumSubCuenta)
);

GO

-- CLASES
INSERT INTO dbo.CONTABILIDAD_CLASE_CUENTA(IdClasCuenta,NombClasC, Naturaleza)
VALUES(1,'ACTIVOS',0),(2,'PASIVOS',1),(3,'PATRIMONIO',1)

INSERT INTO dbo.CONTABILIDAD_CLASE_CUENTA(IdClasCuenta,NombClasC,Naturaleza)
VALUES(4,'INGRESOS',1),(5,'GASTOS',0),(6,'COSTOS DE VENTAS',0), (7,'COSTOS DE PRODUCCIÓN O DE OPERACIÓN',0)

INSERT INTO dbo.CONTABILIDAD_CLASE_CUENTA(IdClasCuenta,NombClasC,Naturaleza)
VALUES(8,'CUENTAS DE ORDEN DEUDORAS',1),(9,'CUENTAS DE ORDEN ACREEDORAS',0)

--SELECT *
--FROM	dbo.CONTABILIDAD_CLASE_CUENTA


-- CLASE ACTIVOS
INSERT INTO dbo.CONTABILIDAD_GRUPO_CUENTA(IdClasCuenta,IdGrupo, NombGrupo)
VALUES	(1,1 ,'ACTIVO CIRCULANTE')
		, (1,2,'ACTIVO NO CIRCULANTE')
		, (1,3,'EFECTIVO')
		, (1,4,'INVENTARIOS')
		, (1,5,'OTROS ACTIVOS')

-- CLASE PASIVOS
INSERT INTO dbo.CONTABILIDAD_GRUPO_CUENTA(IdClasCuenta,IdGrupo, NombGrupo)
VALUES (2,1,'PASIVO CIRCULANTE')
		, (2,2,'PASIVO NO CIRCULANTE')
		, (2,3,'CUENTAS POR PAGAR')
		, (2,4,'PASIVOS ESTIMADOS Y PROVISIONES')
		, (2,5,'OTROS PASIVOS')

-- CLASE PATRIMONIO
INSERT INTO dbo.CONTABILIDAD_GRUPO_CUENTA(IdClasCuenta,IdGrupo, NombGrupo)
VALUES (3,1,'CAPITAL SOCIAL')
		, (3,2,'RESERVAS')
		, (3,3,'REVALUACIONES')

-- CLASE INGRESOS
INSERT INTO dbo.CONTABILIDAD_GRUPO_CUENTA(IdClasCuenta,IdGrupo, NombGrupo)
VALUES (4,1,'INGRESOS OPERACIONALES')
		, (4,2,'INGRESOS NO OPERACIONALES')
		, (4,3,'OTROS INGRESOS')

--CLASE GASTOS
INSERT INTO dbo.CONTABILIDAD_GRUPO_CUENTA(IdClasCuenta,IdGrupo, NombGrupo)
VALUES (5,1,'OPERACIONALES DE ADMINISTRACIÓN')
		, (5,2,'OPERACIONALES DE VENTAS')
		, (5,3,'NO OPERACIONALES')
        , (5,4,'IMPUESTO DE RENTA Y COMPLEMENTARIOS')
		, (5,5,'GANACIAS Y PERDIDAS')
		, (5,6,'OTROS GASTOS')

--CLASE COSTOS DE VENTAS
INSERT INTO dbo.CONTABILIDAD_GRUPO_CUENTA(IdClasCuenta,IdGrupo, NombGrupo)
VALUES (6,1,'COMPRAS')
	   , (6,2,'COSTO DE VENTAS Y PRESTACION DE SERVICIOS')
	   , (6,3,'OTROS COSTOS')

--CLASE COSTOS DE PRODUCCION O OPERACION
INSERT INTO dbo.CONTABILIDAD_GRUPO_CUENTA(IdClasCuenta,IdGrupo, NombGrupo)
VALUES  (7,1,'MATERIA PRIMA')
		, (7,2,'MANO DE OBRA DIRECTA')
		, (7,3,'SERVICIOS')
		, (7,4,'MANTENIMIENTO')
		, (7,5,'SUMINISTROS')
		, (7,6,'ENVASES')
		, (7,7,'OTROS COSTOS')

--CLASE CUENTAS DE ORDEN DEUDORAS
INSERT INTO dbo.CONTABILIDAD_GRUPO_CUENTA(IdClasCuenta,IdGrupo, NombGrupo)
VALUES  (8,1,'DERECHOS CONTINGENTES')
		, (8,2,'DEUDORAS FISCALES')
		, (8,3,'DEUDORAS DE CONTROL')
		, (8,4,'DEUDORAS POR CONTRA(CR)')

--CLASE CUENTAS DE ORDEN ACREEDORAS
INSERT INTO dbo.CONTABILIDAD_GRUPO_CUENTA(IdClasCuenta,IdGrupo, NombGrupo)
VALUES  (9,1,'DERECHOS CONTINGENTES')
		, (9,2,'DEUDORAS FISCALES')
		, (9,3,'DEUDORAS DE CONTROL')
		, (9,4,'DEUDORAS POR CONTRA(DB)')


--------------------------------------CUENTAS---------------------------------------------------
--CLASE ACTIVOS, GRUPO ACTIVO CIRCULANTE
INSERT INTO CONTABILIDAD_CUENTA(IDCLASCUENTA,IDGRUPO,IDMONEDA,NUMCUENTA,NOMBCUENTA,DESCCUENTA)
VALUES (1,1,1,1101,'CAJA', 'CAJA')
		, (1,1,1,1102,'BANCOS', 'BANCOS')
		, (1,1,1,1103,'DOCUMENTOS POR COBRAR', 'DOCUMENTOS POR COBRAR')
		, (1,1,1,1104,'DEUDORES DIVERSOS', 'DEUDORES DIVERSOS')
		, (1,1,1,1105,'ALMACÉN', 'ALMACÉN')

--CLASE ACTIVOS, GRUPO INVENTARIOS
INSERT INTO CONTABILIDAD_CUENTA(IDCLASCUENTA,IDGRUPO,IDMONEDA,NUMCUENTA,NOMBCUENTA,DESCCUENTA)
VALUES (1,4,1,1401,'MATERIAS PRIMAS', '')
		, (1,4,1,1402,'PRODUCTOS TERMINADOS ', '')
		, (1,4,1,1403,'MERCANCÍAS NO FABRICADAS POR LA EMPRESA', '')
		, (1,4,1,1404,'MATERIALES, REPUESTOS Y ACCESORIOS ', '')
		, (1,4,1,1405,'PROVISIONES ', '')


--CLASE PASIVOS, GRUPO PASIVO CIRCULANTE
INSERT INTO CONTABILIDAD_CUENTA(IDCLASCUENTA,IDGRUPO,IDMONEDA,NUMCUENTA,NOMBCUENTA,DESCCUENTA)
VALUES (2,2,1,2201,'PROVEEDORES', '')
		, (2,2,1,2202,'ACREEDORES', '')
		, (2,2,1,2203,'IMPUESTOS POR PAGAR', '')
		, (2,2,1,2204,'DOCUMENTOS POR PAGAR', '')

--CLASE PASIVOS, GRUPO PASIVOS ESTIMADOS Y PROVISIONES
INSERT INTO CONTABILIDAD_CUENTA(IDCLASCUENTA,IDGRUPO,IDMONEDA,NUMCUENTA,NOMBCUENTA,DESCCUENTA)
VALUES (2,4,1,2401,'PARA COSTOS Y GASTOS', '')
		, (2,4,1,2402,'PARA OBLIGACIONES LABORALES ', '')
		, (2,4,1,2403,'PARA OBLIGACIONES FISCALES ', '')
		, (2,4,1,2404,'PARA MANTENIMIENTO Y REPARACIONES ', '')
		, (2,4,1,2405,'PARA CONTINGENCIAS ', '')
		, (2,4,1,2406,'PROVISIONES DIVERSAS ', '')

--CLASE INGRESOS, GRUPO OPERACIONALES, 
INSERT INTO CONTABILIDAD_CUENTA(IDCLASCUENTA,IDGRUPO,IDMONEDA,NUMCUENTA,NOMBCUENTA,DESCCUENTA)
VALUES (4,1,1,4101,'RESTAURANTE', '')
		, (4,1,1,4102,'BARES', '')

--CLASE GASTOS, GRUPO OPERACIONALES DE ADMINISTRACION
INSERT INTO CONTABILIDAD_CUENTA(IDCLASCUENTA,IDGRUPO,IDMONEDA,NUMCUENTA,NOMBCUENTA,DESCCUENTA)
VALUES (5,1,1,5101,'GASTOS DE PERSONAL', '')
		, (5,1,1,5102,'HONORARIOS', '')
		, (5,1,1,5103,'IMPUESTOS', '')
		, (5,1,1,5104,'CONTRIBUCIONES Y AFILIACIONES', '')
		, (5,1,1,5105,'SEGUROS', '')
		, (5,1,1,5106,'SERVICIOS', '')
		, (5,1,1,5107,'GASTOS LEGALES', '')
		, (5,1,1,5108,'MANTENIMIENTO Y REPARACIONES', '')
		, (5,1,1,5109,'ADECUACION Y INSTALACION', '')
		, (5,1,1,5110,'GASTOS DE VIAJE', '')
		, (5,1,1,5111,'DIVERSOS', '')

--CLASE GASTOS , GRUPO OPERACIONALES DE VENTAS
INSERT INTO CONTABILIDAD_CUENTA(IDCLASCUENTA,IDGRUPO,IDMONEDA,NUMCUENTA,NOMBCUENTA,DESCCUENTA)
VALUES (5,2,1,5201,'GASTOS DE PERSONAL', '')
		, (5,2,1,5202,'HONORARIOS', '')
		, (5,2,1,5203,'IMPUESTOS', '')
		, (5,2,1,5204,'CONTRIBUCIONES Y AFILIACIONES', '')
		, (5,2,1,5205,'SEGUROS', '')
		, (5,2,1,5206,'SERVICIOS', '')
		, (5,2,1,5207,'GASTOS LEGALES', '')
		, (5,2,1,5208,'MANTENIMIENTO Y REPARACIONES', '')
		, (5,2,1,5209,'ADECUACION Y INSTALACION', '')
		, (5,2,1,5210,'GASTOS DE VIAJE', '')
		, (5,2,1,5211,'DIVERSOS', '')

--CLASE GASTOS, GRUPO NO OPERACIONALES 
INSERT INTO CONTABILIDAD_CUENTA(IDCLASCUENTA,IDGRUPO,IDMONEDA,NUMCUENTA,NOMBCUENTA,DESCCUENTA)
VALUES (5,3,1,5301,'FINANCIEROS', '')
		, (5,3,1,5302,'PERDIDA EN VENTA Y RETIRO DE BIENES', '')
		, (5,3,1,5303,'EXTRAORDINARIOS', '')
		, (5,3,1,5304,'DIVERSOS', '')


--CLASE COSTOS DE VENTAS, GRUPO COMPRAS
INSERT INTO CONTABILIDAD_CUENTA(IDCLASCUENTA,IDGRUPO,IDMONEDA,NUMCUENTA,NOMBCUENTA,DESCCUENTA)
VALUES (6,1,1,6101,'MERCANCIAS', '')
		, (6,1,1,6102,'MATERIA PRIMA', '')
		, (6,1,1,6103,'MATERIALES INDIRECTOS', '')
		, (6,1,1,6104,'COMPRA DE ENERGIA', '')
		, (6,1,1,6105,'DEVOLUCIONES EN COMPRAS (CR)', '')

--CLASE COSTOS DE VENTAS, GRUPO COSTOS DE VENTAS Y DE PRESTACION DE SERVICIOS
INSERT INTO CONTABILIDAD_CUENTA(IDCLASCUENTA,IDGRUPO,IDMONEDA,NUMCUENTA,NOMBCUENTA,DESCCUENTA)
VALUES (6,2,1,6201,'RESTAURANTES', '')

--CLASE COSTOS DE PRODUCCION O OPERACION, GRUPO MATERIA PRIMERA
INSERT INTO CONTABILIDAD_CUENTA(IDCLASCUENTA,IDGRUPO,IDMONEDA,NUMCUENTA,NOMBCUENTA,DESCCUENTA)
VALUES (7,1,1,7201,'PRODUCTOS ALIMENTICIOS', '')
		, (7,1,1,7202,'BEBIDAS,LICORES Y ALCOHOLES', '')


------------------------------------------SUBCUENTAS------------------------------------

-------------------------------GASTOS OPERACIONALES DE ADMINISTRACION-----------------------------------

--GASTOS DE PERSONAL
INSERT INTO CONTABILIDAD_SUBCUENTA(NumCuenta,NumSubCuenta,NombSubCuenta)
VALUES(5101,510101,'Sueldos')
       , (5101,510102,'Horas extras y recargos')
	   , (5101,510103,'Comisiones')
	   , (5101,510105,'Viaticos')

--HONORARIOS
INSERT INTO CONTABILIDAD_SUBCUENTA(NumCuenta,NumSubCuenta,NombSubCuenta)
VALUES(5102,510201,'Junta directiva')
       , (5102,510202,'Revisoria fiscal')
	   , (5102,510203,'Auditoria externa')
	   , (5102,510204,'Asesoría jurídica')
	   , (5102,510205,'Asesoría financiera')
	   , (5102,510206,'Asesoría tecnica')
	   , (5102,510207,'Otros')

--IMPUESTOS
INSERT INTO CONTABILIDAD_SUBCUENTA(NumCuenta,NumSubCuenta,NombSubCuenta)
VALUES(5103,510301,'Industria y comercio')
       , (5103,510302,'De timbres')
	   , (5103,510303,'A la propiedad raiz')
	   , (5103,510304,'Derechos sobre instrumentos publicos')
	   , (5103,510305,'De vehiculos')
	   , (5103,510306,'IVA Descontable')
	   , (5103,510307,'Otros')

--CONTRIBUCIONES Y AFILIACIONES
INSERT INTO CONTABILIDAD_SUBCUENTA(NumCuenta,NumSubCuenta,NombSubCuenta)
VALUES(5104,510401,'Contribuciones')
       , (5104,510402,'Afiliaciones y sostenimiento')

--SEGUROS
INSERT INTO CONTABILIDAD_SUBCUENTA(NumCuenta,NumSubCuenta,NombSubCuenta)
VALUES(5105,510501,'Terremoto')
       , (5105,510502,'Sustraccion y Hurto')
	   , (5105,510503,'Equipo de transporte')
	   , (5105,510504,'Obligatorio accidente de transito')
	   , (5105,510505,'Transporte de mercancia')
	   , (5105,510506,'Otros')

--SERVICIOS
INSERT INTO CONTABILIDAD_SUBCUENTA(NumCuenta,NumSubCuenta,NombSubCuenta)
VALUES(5106,510601,'Aseo y vigilancia')
       , (5106,510602,'Temporales')
	   , (5106,510603,'Asistencia técnica')
	   , (5106,510604,'Procesamiento electrónico de datos')
	   , (5106,510605,'Acueducto y alcantarillado')
	   , (5106,510606,'Energia eléctrica')
	   , (5106,510607,'Telefono')
	   , (5106,510608,'Fax')
	   , (5106,510609,'Transporte, fletes y acarreo')
	   , (5106,510610,'Gas')
	   , (5106,510611,'Otros')

--GASTOS LEGALES
INSERT INTO CONTABILIDAD_SUBCUENTA(NumCuenta,NumSubCuenta,NombSubCuenta)
VALUES(5107,510701,'Notariales')
       , (5107,510702,'Registro mercantil')
	   , (5107,510703,'Trámites y licencias')
	   , (5107,510704,'Otros')

--MANTENIMIENTO Y REPARACIONES
INSERT INTO CONTABILIDAD_SUBCUENTA(NumCuenta,NumSubCuenta,NombSubCuenta)
VALUES(5108,510801,'Terrenos')
       , (5108,510802,'Construcciones y edificaciones')
	   , (5108,510803,'Maquinaria y equipo')
	   , (5108,510804,'Equipo de oficina')
	   , (5108,510805,'Equipo de computación y comunicación')
	   , (5108,510806,'Otros')


--ADECUACION E INSTALACION
INSERT INTO CONTABILIDAD_SUBCUENTA(NumCuenta,NumSubCuenta,NombSubCuenta)
VALUES(5109,510901,'Instalaciones eléctricas')
       , (5109,510902,'Arreglos ornamentales')
	   , (5109,510903,'Reparaciones locativas')
	   , (5109,510904,'Otros')


--VIAJES
INSERT INTO CONTABILIDAD_SUBCUENTA(NumCuenta,NumSubCuenta,NombSubCuenta)
VALUES(5110,511001,'Alojamiento y manutencion')
       , (5110,511002,'Pasajes aereos')
	   , (5110,511003,'Pasajes fluviales y/o maritimos')
	   , (5110,511004,'Pasajes terrestres')
	   , (5110,511005,'Pasajes ferreos')
	   , (5110,511006,'Otros')

--DIVERSOS
INSERT INTO CONTABILIDAD_SUBCUENTA(NumCuenta,NumSubCuenta,NombSubCuenta)
VALUES(5111,511101,'Comisiones')
       , (5111,511102,'Libros, suscripciones, periodicos y revistas')
	   , (5111,511103,'Musica ambiental')
	   , (5111,511104,'Gastos de representacion y relaciones públicas')
	   , (5111,511105,'Elementos de aseo y cafetería')
	   , (5111,511106,'Útiles, papelería y fotocopias')
	   , (5111,511107,'Combustibles y lubricantes')
	   , (5111,511108,'Envases y empaques')
	   , (5111,511109,'Taxis y buses')
	   , (5111,511110,'Estampillas')
	   , (5111,511111,'Casino y restaurante')
	   , (5111,511112,'Parqueaderos')
	   , (5111,511113,'Indemnización por daños a terceros')
	   , (5111,511114,'Polvora y similares')
	   , (5111,511115,'Otros')
	   


--GASTOS OPERACIONES DE ADMINISTRACION
--SELECT  CUE.NombCuenta
--		, SUB.NumCuenta
--		, SUB.NumSubCuenta
--		, SUB.NombSubCuenta
--FROM	dbo.CONTABILIDAD_CUENTA CUE
--		INNER JOIN dbo.CONTABILIDAD_SUBCUENTA SUB
--			ON SUB.NumCuenta = CUE.NumCuenta
--WHERE	CUE.IdGrupo = 1
--		AND CUE.IdClasCuenta = 5